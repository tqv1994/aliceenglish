'use strict';(function(v){let w;const x=function(a,b){this.$table=v(a);this.top=window.top.document;this.init(b)};x.prototype={$table:null,app:null,init(a){this.app=a;this.loadExtraFields(a.values);this.makeSortable();this.events()},loadOrders(a,b){let d,c;try{d=JSON.parse(a.field_order)}catch(n){}d||(d={});a=this.$table[0].getElementsByTagName("tbody")[0];const e=a.getElementsByTagName("tr"),f=[],h=document.createDocumentFragment();for(let b=0,a=e.length;b<a;++b)e[b].classList.contains("tb_no_sort")?
c=e[b]:f.push(e[b]);f.sort(function(a,c){let e;var f=a.classList.contains("tb_contact_new_row");var h=c.classList.contains("tb_contact_new_row");let n=function(a){for(let c=b.length-1;-1<c;--c)if((b[c].label===a||b[c].id===a)&&void 0!==b[c].order)return b[c].order;return!1};a=f?a.getElementsByClassName("tb_new_field_textbox")[0]:a.getElementsByClassName("tb_lb_option")[0];c=h?c.getElementsByClassName("tb_new_field_textbox")[0]:c.getElementsByClassName("tb_lb_option")[0];f&&a.dataset.order?f=a.dataset.order:
(e=f?a.value:a.id,e=f&&""===e?a.dataset.id:e,e=e.trim(),f=void 0!==d[e]?d[e]:f?n(e):!1);h&&c.dataset.order?h=c.dataset.order:(a=h?c.value:c.id,a=h&&""===a?c.dataset.id:a,a=a.trim(),h=void 0!==d[a]?d[a]:h?n(a):!1);return f-h});for(let a=0,b=f.length;a<b;++a)h.appendChild(f[a]);for(h.appendChild(c);a.firstChild;)a.removeChild(a.lastChild);a.appendChild(h)},loadExtraFields(a){let b,d=this.$table[0].getElementsByClassName("tb_no_sort")[0];try{b=JSON.parse(a.field_extra).fields}catch(e){}b||(b={fields:[]});
const c=document.createDocumentFragment();for(let a=0,d=b.length;a<d;++a)c.appendChild(this.addField(b[a]));d.parentNode.insertBefore(c,d);this.loadOrders(a,b)},events(){const a=this;this.$table.on("click.tb_contact",".tb_new_field_action",function(b){b.preventDefault();b.stopPropagation();b=this.closest(".tb_no_sort");b.parentNode.insertBefore(a.addField({}),b);a.$table.find("tbody").sortable("refresh");a.changeObject()}).on("change.tb_contact",".tb_new_field_type",function(){a.switchField(this);
a.changeObject()}).on("click.tb_contact",".tb_add_field_option",function(b){b.preventDefault();b.stopPropagation();this.previousElementSibling.appendChild(a.render.getOptions([""]))}).on("keyup.tb_contact",'.tb_contact_new_row input[type="text"], .tb_contact_new_row textarea',function(){a.changeObject()}).on("change.tb_contact",".tb_contact_new_row .tb_new_field_required",function(){a.changeObject()}).on("click.tb_contact",".tb_contact_value_remove,.tb_contact_field_remove",function(b){b.preventDefault();
b.stopPropagation();this.classList.contains("tb_contact_value_remove")?v(this).closest("li").remove():v(this).closest(".tb_contact_new_row").remove();a.changeObject()})},makeSortable(){const a=this;this.$table.find("tbody").sortable({items:"tr:not(.tb_no_sort)",placeholder:"ui-state-highlight",axis:"y",containment:"parent",update(){a.changeObject()}})},render:{call(a,b){return void 0===this[b]?this._default(a,b):this[b].call(this,a,b)},setType(a,b){a.setAttribute("data-type",b)},getText(a,b,d){const c=
document.createElement(d);"textarea"!==d&&(c.type="tel"!==d?"text":"tel");a.value&&(c.value=a.value.replace(/&quot;/g,'"'));c.className="tb_new_field_value tb_field_type_text";this.setType(c,b);return c},static(a,b){a=this._default(a,"textarea");a.placeholder=tb_contact_l10n.static_text;this.setType(a,"static");return a},upload(a,b){return document.createElement("div")},getOptions(a){const b=document.createDocumentFragment();for(let d in a){let c=document.createElement("li"),e=document.createElement("a"),
f=document.createElement("input");f.type="text";f.className="tb_multi_option";f.value=a[d];e.className="tb_contact_value_remove tf_close";e.href="#";c.appendChild(f);c.appendChild(e);b.appendChild(c)}return b},_default(a,b){if("text"===b||"textarea"===b||"tel"===b)return this.getText(a,b,"textarea"===b?b:"input");const d=document.createElement("ul"),c=document.createElement("a"),e=document.createDocumentFragment();d.appendChild(this.getOptions(a.value||[""]));e.appendChild(d);c.href="#";c.className=
"tb_add_field_option";c.textContent=tb_contact_l10n.add_option;this.setType(c,b);e.appendChild(c);return e}},addField(a){var b=0===Object.keys(a).length;const d=a.type?a.type:"text",c=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("input"),h=document.createElement("td"),n=document.createElement("div"),u=document.createElement("select"),q=document.createDocumentFragment(),g=document.createElement("div"),r=document.createElement("div"),p=document.createElement("label"),
m=document.createElement("input"),l=document.createElement("a"),k=tb_contact_l10n.types,t="tb_"+tb_app.Utils.generateUniqueID();g.className="control-input tf_rel";r.className="tb_new_field";n.className="selectwrapper";u.className="tb_new_field_type tb_lb_option";c.className="tb_contact_new_row";f.type="text";f.className="tb_new_field_textbox";f.value=void 0===a.label?!0===b?tb_contact_l10n.field_name:"":a.label.replace(/&quot;/g,'"');f.dataset.id=void 0===a.id?"":a.id;f.dataset.order=void 0===a.order?
"":a.order;m.type="checkbox";m.className="tb_new_field_required";m.value="required";"static"===d&&(p.style.display="none");!0===a.required&&(m.checked=!0);l.className="tb_contact_field_remove tf_close";l.href="#";h.setAttribute("colspan","3");e.appendChild(f);c.appendChild(e);for(let a in k)b=document.createElement("option"),b.name=t,a===d&&(b.selected="selected"),b.value=a,b.textContent=k[a],q.appendChild(b);u.appendChild(q);n.appendChild(u);h.appendChild(n);g.appendChild(this.render.call(a,d));
r.appendChild(g);p.appendChild(m);p.appendChild(document.createTextNode(tb_contact_l10n.req));r.appendChild(p);h.appendChild(r);h.appendChild(l);c.appendChild(h);return c},switchField(a){const b=a.value;a=a.closest("td").getElementsByClassName("control-input")[0];const d=a.closest(".tb_new_field").getElementsByClassName("tb_new_field_required")[0].parentNode;for(;a.firstChild;)a.removeChild(a.lastChild);a.appendChild(this.render.call({},b));d.style.display="static"===b?"none":""},changeObject(a){var b=
this.$table[0].getElementsByTagName("tbody")[0].getElementsByTagName("tr");const d={fields:[]};var c={};for(let a=0,n=b.length;a<n;++a)if(b[a].classList.contains("tb_contact_new_row")){var e=b[a].getElementsByClassName("tb_new_field_type")[0].options[b[a].getElementsByClassName("tb_new_field_type")[0].selectedIndex].value;let c=b[a].getElementsByClassName("tb_new_field_textbox")[0].value.trim(),h="static"!==e&&!0===b[a].getElementsByClassName("tb_new_field_required")[0].checked,g;switch(e){case "text":case "textarea":case "static":case "tel":g=
b[a].getElementsByClassName("tb_new_field_value")[0].value.trim();break;case "radio":case "select":case "checkbox":g=[];var f=b[a].getElementsByClassName("control-input")[0].getElementsByTagName("input");for(let a=0,b=f.length;a<b;++a){let b=f[a].value.trim();""!==b&&g.push(b)}}if(""!==g&&void 0!==g||""!==c){f={type:e,order:a};h&&(f.required=h);""!==c?f.label=c.replace(/"/g,"&quot;"):f.id="ex"+a;if(void 0!==g&&""!==g&&0<g.length){if("static"===e)g=g.replace(/"/g,'\\\\"');else if("text"===e||"textarea"===
e)g=g.replace(/"/g,"&quot;");if("static"===e||"textarea"===e)g=g.replace(/\n/g,"\\\\n");f.value=g}d.fields.push(f)}}else b[a].classList.contains("tb_no_sort")||(e=b[a].getElementsByClassName("tb_lb_option")[0].id,c[e]=a);b=this.top.getElementById("field_extra");c=JSON.stringify(c);b.value=JSON.stringify(d);this.top.getElementById("field_order").value=c;this.app.settings.field_order=c;a||Themify.triggerEvent(b,"change")}};let y=null;tb_app.Constructor.contact_fields={render(a,b){var d=window.top;null===
y&&(y=!0,d.Themify.LoadCss(tb_contact_l10n.admin_css,tb_contact_l10n.v));d=document.createElement("tr");const c=document.createElement("table"),e=document.createElement("thead"),f=document.createElement("tbody"),h=document.createElement("tfoot"),n=document.createDocumentFragment(),u=a.options.head;var q=a.options.body;const g=a.options.foot,r={text(a,c,d){a={id:"field_"+a,placeholder:c,"class":"large",type:"text"};d&&(a.help=d);return b.create([a])},checkbox(a){const c={id:"field_"+a,new_line:!0,
type:"checkbox",options:[{value:"",name:"yes"}]};"sendcopy_active"===a?c.binding={checked:{show:"field_sendcopy_subject"},not_checked:{hide:"field_sendcopy_subject"}}:"optin_active"===a&&(c.binding={checked:{show:"optin"},not_checked:{hide:"optin"}});return b.create([c])}};for(var p in u){var m=document.createElement("th");"l"===p&&(m.colSpan=2);m.textContent=u[p];d.appendChild(m)}e.appendChild(d);for(var l in q){d=document.createElement("tr");for(var k in u){p=document.createElement("td");m=null;
if("f"===k)m=document.createElement("span"),p.textContent=q[l];else if("l"===k){if(p.colSpan="2",m=r.text(l+"_label",q[l]),m.appendChild(r.text(l+"_placeholder",tb_contact_l10n.pl)),"message"!==l){var t=document.createDocumentFragment(),v=r.checkbox(l+"_require");t.appendChild(m);v.querySelector(".tb_lb_option").appendChild(document.createTextNode(tb_contact_l10n.req));t.appendChild(v);m=t}}else"sh"===k&&(m=r.checkbox(l+"_active"));null!==m&&p.appendChild(m);d.appendChild(p)}n.appendChild(d)}d=document.createElement("tr");
l=document.createElement("td");k=document.createElement("a");q=document.createElement("span");k.className="tb_new_field_action";k.href="#";q.className="tf_plus_icon";k.appendChild(q);k.appendChild(document.createTextNode(a.new_row));l.setAttribute("colspan","4");l.appendChild(k);d.className="tb_no_sort";d.appendChild(l);n.appendChild(d);f.appendChild(n);for(let c in g)if("align"!==c){d=document.createElement("tr");for(let e in u)if("sh"!==e||"send"!==c)a=document.createElement("td"),k=null,"f"===
e?a.textContent=g[c]:"l"===e?(a.colSpan=2,l=r.text(c+"_label",g[c]),"send"===c?(a.colSpan=3,t=document.createDocumentFragment(),k=b.select.render({id:g.align.id,options:g.align.options},b),t.appendChild(l),t.appendChild(k),t.appendChild(document.createTextNode(g.align.label)),k=t):"optin"===c?(k=document.createDocumentFragment(),q=ThemifyConstructor.create([{type:"optin_provider",id:"optin"}]),k.appendChild(l),k.appendChild(q)):k=l,t.appendChild(v)):"sh"===e&&"send"!==c&&(k=r.checkbox(c+"_active"),
"captcha"===c&&""!==tb_contact_l10n.captcha&&k.querySelector("input").addEventListener("change",function(a){a=this.closest("td").previousElementSibling;if(!0===this.checked){const b=document.createElement("div");b.className="tb_captcha_message tb_field_error_msg";b.innerHTML=tb_contact_l10n.captcha;a.appendChild(b)}else a=a.getElementsByClassName("tb_captcha_message")[0],"undefined"!==typeof a&&a.parentNode.removeChild(a)},{passive:!0})),null!==k&&a.appendChild(k),"l"===e&&"sendcopy"===c&&a.appendChild(b.create([{id:"field_"+
c+"_subject",after:tb_contact_l10n.sendcopy_sub,type:"text","class":"small"}])),d.appendChild(a);n.appendChild(d)}h.appendChild(n);c.className="contact_fields";c.appendChild(e);c.appendChild(f);c.appendChild(h);document.addEventListener("tb_editing_contact",function(a){w=new x(c,b);Themify.body.one("themify_builder_lightbox_close",function(a){w.$table.off("click.tb_contact keyup.tb_contact change.tb_contact");w=null})},{once:!0});return c}};"visual"===tb_app.mode&&(document.addEventListener("tb_inline_item",
function(a){if(w){var b=a.detail.activeEl;if(null!==b.parentNode.closest(".builder-contact-field-extra")){const d=ThemifyBuilderCommon.Lightbox.$lightbox[0],c=b.previousElementSibling?b.previousElementSibling.type:null,e=b.getAttribute("data-name");delete ThemifyConstructor.settings[e];"checkbox"===c||"order"===c?(b=Themify.convert(b.closest(".control-input").querySelectorAll("[data-name]")).indexOf(b),a.detail.el=d.querySelector('[data-order="'+e+'"]').closest(".tb_contact_new_row").getElementsByClassName("tb_multi_option")[b]):
a.detail.el=d.querySelector('[data-order="'+e+'"]');w.changeObject(!0)}}},{passive:!0}),document.addEventListener("tb_inline_save",function(a){const b=a.detail.activeEl;if(null!==b.parentNode.closest(".builder-contact-field-extra")){const d=b.getAttribute("data-name"),c=a.detail.data;a=a.detail.val;const e=JSON.parse(c.field_extra).fields;delete c[d];for(let c=e.length-1;-1<c;--c)if(e[c].order==d){if(!Array.isArray(e[c].value)||b.parentNode.classList.contains("control-label"))e[c].label=a;else for(let d=
b.closest(".control-input").children,f=d.length-1;-1<f;--f)if(d[f].contains(b)){e[c].value[f]=a;break}break}c.field_extra=JSON.stringify({fields:e})}},{passive:!0}))})(jQuery);
